---
phase: 07-social-watch-tool
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - n8n workflow: Social Watch (new)
  - n8n workflow: Web API Router (o5t83JWF11dsSfyi)
autonomous: false

must_haves:
  truths:
    - "User can ask about saved competitor data and get instant response"
    - "Agent uses Social Watch for queries, Social Scout only for fresh scraping"
    - "Response includes follower_count, viral_score, summary_analysis, recent_posts"
    - "Agent can list all saved competitors for a user"
  artifacts:
    - path: "n8n workflow: Social Watch"
      provides: "Query saved competitor data from database"
      contains: "Execute Workflow Trigger, Supabase queries"
    - path: "n8n workflow: Web API Router"
      provides: "social_watch tool registration"
      contains: "toolWorkflow connection to Social Watch"
  key_links:
    - from: "Web API Router"
      to: "Social Watch workflow"
      via: "toolWorkflow node"
      pattern: "social_watch"
    - from: "Social Watch workflow"
      to: "Supabase"
      via: "competitors and social_stats table queries"
---

<objective>
Create Social Watch tool for querying saved competitor data without re-scraping

Purpose: Currently the agent must run expensive Social Scout scraping even when data already exists in the database. Social Watch provides instant access to previously saved competitor intelligence.

Output: New Social Watch n8n workflow registered as tool in Web API Router, enabling agent to differentiate between querying saved data vs fresh scraping.
</objective>

<execution_context>
@/Users/MSIModern14/.claude/get-shit-done/workflows/execute-plan.md
@/Users/MSIModern14/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/todos/pending/2026-01-30-add-social-watch-tool.md
@CLAUDE.md (n8n MCP tools, workflow patterns, database schema)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Social Watch n8n Workflow</name>
  <files>n8n workflow (new)</files>
  <action>
Create new n8n workflow "Social Watch" using n8n MCP tools:

1. **Workflow Structure:**
   - Execute Workflow Trigger (receives user_id, query parameters)
   - Supabase node: Query competitors table for user
   - Switch node: Route based on query type (list all, single competitor, compare)
   - Supabase node: Query social_stats with JOIN to competitors
   - Code node: Format response with all relevant fields
   - Return output

2. **Input Schema (from Execute Workflow Trigger):**
   ```json
   {
     "user_id": "uuid",
     "action": "list|get|compare",
     "competitor_name": "optional string",
     "competitor_ids": "optional array of uuids"
   }
   ```

3. **Query Logic:**
   - `list`: Return all competitors for user with latest social_stats
   - `get`: Return single competitor by name with full history
   - `compare`: Return multiple competitors side by side

4. **Supabase Queries:**
   - Competitors: `SELECT * FROM competitors WHERE user_id = $user_id`
   - Social Stats: `SELECT s.*, c.name, c.platform, c.url FROM social_stats s JOIN competitors c ON s.competitor_id = c.id WHERE c.user_id = $user_id ORDER BY s.scraped_at DESC`

5. **Output Format:**
   ```json
   {
     "success": true,
     "data": {
       "competitors": [
         {
           "name": "string",
           "platform": "facebook|tiktok",
           "url": "string",
           "latest_stats": {
             "follower_count": number,
             "viral_score": number,
             "summary_analysis": "string",
             "recent_posts": [],
             "is_running_ads": boolean,
             "scraped_at": "timestamp"
           }
         }
       ]
     }
   }
   ```

6. **Use existing credentials:**
   - supabaseApi: "JbItbwVcQiGCLFAC" (NemoAIDatabase)

7. **Workflow settings:**
   - Name: "Social Watch"
   - Active: true (or manual activation note)
  </action>
  <verify>
Use n8n MCP to verify workflow exists:
- `n8n_list_workflows` shows "Social Watch"
- `n8n_get_workflow` returns valid workflow with Execute Workflow Trigger
- Workflow has Supabase query nodes configured
  </verify>
  <done>
Social Watch workflow created in n8n with:
- Execute Workflow Trigger accepting user_id and action
- Supabase queries for competitors and social_stats
- Formatted JSON response with all competitor data
  </done>
</task>

<task type="auto">
  <name>Task 2: Register Social Watch Tool in Web API Router</name>
  <files>n8n workflow: Web API Router (o5t83JWF11dsSfyi)</files>
  <action>
Add Social Watch as a tool to the Web API Router AI Agent:

1. **Get current Web API Router workflow:**
   - Use `n8n_get_workflow` with ID `o5t83JWF11dsSfyi`

2. **Add toolWorkflow node:**
   ```json
   {
     "parameters": {
       "name": "social_watch",
       "description": "Use this tool to retrieve SAVED competitor data that was previously scraped and stored in the database. Returns follower counts, viral scores, analysis summaries, and recent posts. Use this when user asks about competitors they have already added. Use Social Scout tool ONLY when user explicitly requests FRESH/NEW data or wants to add a NEW competitor.",
       "workflowId": { "value": "<SOCIAL_WATCH_WORKFLOW_ID>" },
       "fields": {
         "values": [
           { "name": "user_id", "type": "string" },
           { "name": "action", "type": "string" },
           { "name": "competitor_name", "type": "string" },
           { "name": "competitor_ids", "type": "string" }
         ]
       }
     },
     "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
     "typeVersion": 1.2,
     "position": [calculated based on existing tools],
     "id": "generate-uuid",
     "name": "social_watch"
   }
   ```

3. **Connect to AI Agent:**
   - Add connection from "social_watch" node to AI Agent's ai_tool input

4. **Update Social Scout tool description (if needed):**
   - Clarify: "Use this to SCRAPE FRESH data from social media. Only use when user wants NEW/UPDATED information or to add a NEW competitor. For existing saved data, use social_watch tool instead."

5. **Deploy update:**
   - Use `n8n_update_workflow` or `n8n_update_partial_workflow`
  </action>
  <verify>
- `n8n_get_workflow` for Web API Router shows social_watch toolWorkflow node
- Tool description clearly differentiates from Social Scout
- Connection exists from social_watch to AI Agent
  </verify>
  <done>
Web API Router updated with:
- social_watch tool registered with clear description
- Connected to AI Agent for tool use
- Social Scout description updated to clarify fresh scraping only
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Social Watch Tool Works</name>
  <what-built>
Social Watch tool that queries saved competitor data from database, integrated into Web API Router AI Agent
  </what-built>
  <how-to-verify>
1. Open NemoAI chat interface
2. Make sure you have at least one saved competitor (if not, use Social Scout first to scrape one)
3. Ask: "Show me my saved competitors"
   - Expected: Agent uses social_watch tool, returns list of competitors with stats
4. Ask: "How is [competitor name] doing?"
   - Expected: Agent uses social_watch tool, returns that competitor's saved data
5. Ask: "Get fresh data for [competitor name]"
   - Expected: Agent uses Social Scout tool (not social_watch) for new scraping
6. Verify response includes: follower_count, viral_score, summary_analysis, recent_posts
  </how-to-verify>
  <resume-signal>Type "approved" if Social Watch correctly returns saved data, or describe issues encountered</resume-signal>
</task>

</tasks>

<verification>
- [ ] Social Watch workflow exists in n8n and is active
- [ ] Web API Router has social_watch tool connected to AI Agent
- [ ] Agent correctly chooses social_watch for saved data queries
- [ ] Agent correctly chooses Social Scout for fresh scraping requests
- [ ] Response format includes all expected fields
</verification>

<success_criteria>
1. User can ask about saved competitors and get instant response (no scraping delay)
2. Agent differentiates between querying saved data vs requesting fresh scrape
3. All competitor intelligence fields returned: follower_count, viral_score, summary_analysis, recent_posts, is_running_ads
4. Works for single competitor and list all competitors queries
</success_criteria>

<output>
After completion, create `.planning/phases/07-social-watch-tool/07-01-SUMMARY.md`
</output>
